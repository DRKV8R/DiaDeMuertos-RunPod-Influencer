(()=>{var c=class{constructor(){this.socket=io(),this.currentDeployment=null,this.init()}init(){this.setupEventListeners(),this.loadAvailableScripts(),this.setupWebSocket(),this.animatePageLoad()}setupEventListeners(){let e=document.getElementById("deploymentForm"),t=document.getElementById("scriptSelect");e.addEventListener("submit",this.handleDeployment.bind(this)),t.addEventListener("change",this.handleScriptChange.bind(this)),document.getElementById("themeToggle").addEventListener("click",this.toggleTheme.bind(this))}setupWebSocket(){this.socket.on("deployment-log",e=>{this.appendLog(e.message,e.type)}),this.socket.on("deployment-status",e=>{this.updateDeploymentStatus(e.status,e.code)})}async loadAvailableScripts(){try{let t=await(await fetch("/api/scripts")).json();this.populateScriptSelect(t),document.getElementById("totalScripts").textContent=t.length}catch(e){console.error("Failed to load scripts:",e),this.showNotification("Failed to load available scripts","error")}}populateScriptSelect(e){let t=document.getElementById("scriptSelect");t.innerHTML='<option value="">Choose a deployment script...</option>',e.forEach(s=>{let n=document.createElement("option");n.value=s.name,n.textContent=s.displayName,n.dataset.description=s.description,t.appendChild(n)})}handleScriptChange(e){let t=e.target,s=document.getElementById("scriptDescription"),n=t.options[t.selectedIndex];n&&n.dataset.description?(s.innerHTML=`
                <div class="flex items-start space-x-3">
                    <i class="fas fa-info-circle text-dia-orange mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-dia-orange">${n.textContent}</h4>
                        <p class="text-gray-300 mt-1">${n.dataset.description}</p>
                    </div>
                </div>
            `,s.classList.remove("hidden")):s.classList.add("hidden")}async handleDeployment(e){e.preventDefault();let t=new FormData(e.target),n=document.getElementById("scriptSelect").value;if(!n){this.showNotification("Please select a deployment script","warning");return}let o={script:n,gpu:t.get("gpu")||"RTX4090",size:t.get("size")||"small"};try{let i=await fetch("/api/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script:n,config:o})}),a=await i.json();if(i.ok)this.currentDeployment=a.deploymentId,this.socket.emit("subscribe-deployment",a.deploymentId),this.clearLogs(),this.appendLog(`\u{1F680} Starting deployment: ${n}`,"info"),this.updateActiveDeployments(),this.showNotification("Deployment started successfully","success");else throw new Error(a.error)}catch(i){console.error("Deployment failed:",i),this.showNotification(`Deployment failed: ${i.message}`,"error")}}clearLogs(){let e=document.getElementById("logContainer");e.innerHTML=""}appendLog(e,t="stdout"){let s=document.getElementById("logContainer"),n=document.createElement("div");n.className=`mb-1 ${t==="stderr"?"text-red-400":t==="info"?"text-dia-gold":"text-gray-300"}`;let o=new Date().toLocaleTimeString();n.innerHTML=`
            <span class="text-gray-500 text-xs">[${o}]</span> 
            <span>${this.escapeHtml(e)}</span>
        `,s.appendChild(n),s.scrollTop=s.scrollHeight}updateDeploymentStatus(e,t){let s=e==="completed"?"text-green-400":e==="failed"?"text-red-400":"text-yellow-400";this.appendLog(`\u{1F4CA} Deployment ${e} (exit code: ${t})`,"info"),(e==="completed"||e==="failed")&&(this.currentDeployment=null,this.updateActiveDeployments())}updateActiveDeployments(){let e=this.currentDeployment?1:0;document.getElementById("activeDeployments").textContent=e}showNotification(e,t="info"){let s=document.createElement("div");s.className=`
            fixed top-4 right-4 z-50 max-w-sm w-full bg-dia-dark border-l-4 p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300
            ${t==="success"?"border-green-400":t==="error"?"border-red-400":t==="warning"?"border-yellow-400":"border-dia-orange"}
        `;let n=t==="success"?"check-circle":t==="error"?"exclamation-circle":t==="warning"?"exclamation-triangle":"info-circle",o=t==="success"?"text-green-400":t==="error"?"text-red-400":t==="warning"?"text-yellow-400":"text-dia-orange";s.innerHTML=`
            <div class="flex items-center">
                <i class="fas fa-${n} ${o} mr-3"></i>
                <span class="text-white">${e}</span>
                <button class="ml-auto text-gray-400 hover:text-white" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>s.remove(),300)},5e3)}toggleTheme(){let e=document.documentElement,t=document.querySelector("#themeToggle i");e.classList.contains("dark")?(e.classList.remove("dark"),t.className="fas fa-sun"):(e.classList.add("dark"),t.className="fas fa-moon")}animatePageLoad(){document.querySelectorAll(".animate-slide-up").forEach((t,s)=>{setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},s*100)})}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}};document.addEventListener("DOMContentLoaded",()=>{new c});})();
