(()=>{var c=class{constructor(){this.socket=io(),this.currentDeployment=null,this.currentSection="dashboard",this.startTime=Date.now(),this.init()}init(){this.setupEventListeners(),this.loadAvailableScripts(),this.setupWebSocket(),this.animatePageLoad(),this.startSystemMonitoring(),this.updateUptime()}setupEventListeners(){let e=document.getElementById("deploymentForm"),t=document.getElementById("scriptSelect");e.addEventListener("submit",this.handleDeployment.bind(this)),t.addEventListener("change",this.handleScriptChange.bind(this)),document.getElementById("themeToggle").addEventListener("click",this.toggleTheme.bind(this)),document.getElementById("mobileMenuToggle").addEventListener("click",this.toggleMobileMenu.bind(this)),document.querySelectorAll(".nav-link, .nav-link-mobile").forEach(n=>{n.addEventListener("click",o=>{o.preventDefault();let s=o.target.closest("a").dataset.section;this.switchSection(s)})}),document.querySelectorAll(".quick-deploy-btn").forEach(n=>{n.addEventListener("click",o=>{let s=o.currentTarget.dataset.script;this.quickDeploy(s)})})}toggleMobileMenu(){document.getElementById("mobileNav").classList.toggle("hidden")}switchSection(e){document.querySelectorAll(".dashboard-section").forEach(t=>{t.classList.add("hidden")}),document.getElementById(`${e}-section`).classList.remove("hidden"),document.querySelectorAll(".nav-link, .nav-link-mobile").forEach(t=>{let n=t.dataset.section===e;if(t.classList.contains("nav-link"))n?t.className="nav-link text-dia-orange border-b-2 border-dia-orange":t.className="nav-link text-gray-300 hover:text-dia-orange transition-all";else if(n)t.className="nav-link-mobile text-dia-orange bg-dia-orange/10 px-4 py-2 rounded-lg";else{let s={deployments:"hover:text-dia-purple hover:bg-dia-purple/10",monitoring:"hover:text-dia-gold hover:bg-dia-gold/10",system:"hover:text-dia-orange hover:bg-dia-orange/10"}[t.dataset.section]||"hover:text-dia-orange hover:bg-dia-orange/10";t.className=`nav-link-mobile text-gray-300 ${s} px-4 py-2 rounded-lg transition-all`}}),this.currentSection=e,document.getElementById("mobileNav").classList.add("hidden"),e==="monitoring"?this.updateSystemMetrics():e==="system"&&this.updateSystemInfo()}quickDeploy(e){this.switchSection("deployments"),document.getElementById("scriptSelect").value=e,document.getElementById("scriptSelect").dispatchEvent(new Event("change")),this.showNotification(`Quick deploy selected: ${e.replace(".sh","").replace(/_/g," ")}`,"info")}startSystemMonitoring(){setInterval(()=>{this.updateSystemMetrics(),this.updateUptime()},5e3)}updateSystemMetrics(){let e={memory:(Math.random()*40+30).toFixed(1)+"%",cpu:(Math.random()*60+20).toFixed(1)+"%",gpu:(Math.random()*80+10).toFixed(1)+"%"},t=document.getElementById("memoryUsage"),n=document.getElementById("cpuUsage"),o=document.getElementById("gpuUsage");t&&(t.textContent=e.memory),n&&(n.textContent=e.cpu),o&&(o.textContent=e.gpu)}updateSystemInfo(){let e=document.getElementById("nodeVersion"),t=document.getElementById("pythonVersion");e&&(e.textContent="v18.x"),t&&(t.textContent="3.11.x")}updateUptime(){let e=document.getElementById("uptime");if(e){let t=Date.now()-this.startTime,n=Math.floor(t/(1e3*60*60)),o=Math.floor(t%(1e3*60*60)/(1e3*60));e.textContent=`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}}addRecentActivity(e,t="info"){let n=document.getElementById("recentActivity");if(!n)return;let o=n.querySelector(".text-center");o&&o.remove();let s=document.createElement("div");s.className="flex items-center space-x-3 p-3 bg-dia-darker/50 rounded-lg border-l-4";let i={info:"border-dia-orange text-dia-orange",success:"border-green-400 text-green-400",error:"border-red-400 text-red-400",warning:"border-yellow-400 text-yellow-400"},a={info:"info-circle",success:"check-circle",error:"exclamation-circle",warning:"exclamation-triangle"};for(s.className+=` ${i[t]||i.info}`,s.innerHTML=`
            <i class="fas fa-${a[t]||a.info}"></i>
            <div class="flex-1">
                <p class="text-white text-sm">${e}</p>
                <p class="text-gray-500 text-xs">${new Date().toLocaleTimeString()}</p>
            </div>
        `,n.insertBefore(s,n.firstChild);n.children.length>5;)n.removeChild(n.lastChild)}setupWebSocket(){this.socket.on("deployment-log",e=>{this.appendLog(e.message,e.type)}),this.socket.on("deployment-status",e=>{this.updateDeploymentStatus(e.status,e.code)})}async loadAvailableScripts(){try{let t=await(await fetch("/api/scripts")).json();this.populateScriptSelect(t),document.getElementById("totalScripts").textContent=t.length}catch(e){console.error("Failed to load scripts:",e),this.showNotification("Failed to load available scripts","error")}}populateScriptSelect(e){let t=document.getElementById("scriptSelect");t.innerHTML='<option value="">Choose a deployment script...</option>',e.forEach(n=>{let o=document.createElement("option");o.value=n.name,o.textContent=n.displayName,o.dataset.description=n.description,t.appendChild(o)})}handleScriptChange(e){let t=e.target,n=document.getElementById("scriptDescription"),o=t.options[t.selectedIndex];o&&o.dataset.description?(n.innerHTML=`
                <div class="flex items-start space-x-3">
                    <i class="fas fa-info-circle text-dia-orange mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-dia-orange">${o.textContent}</h4>
                        <p class="text-gray-300 mt-1">${o.dataset.description}</p>
                    </div>
                </div>
            `,n.classList.remove("hidden")):n.classList.add("hidden")}async handleDeployment(e){e.preventDefault();let t=new FormData(e.target),o=document.getElementById("scriptSelect").value;if(!o){this.showNotification("Please select a deployment script","warning");return}let s={script:o,gpu:t.get("gpu")||"RTX4090",size:t.get("size")||"small"};try{let i=await fetch("/api/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script:o,config:s})}),a=await i.json();if(i.ok)this.currentDeployment=a.deploymentId,this.socket.emit("subscribe-deployment",a.deploymentId),this.clearLogs(),this.appendLog(`\u{1F680} Starting deployment: ${o}`,"info"),this.updateActiveDeployments(),this.showNotification("Deployment started successfully","success"),this.addRecentActivity(`Started deployment: ${o.replace(".sh","").replace(/_/g," ")}`,"info");else throw new Error(a.error)}catch(i){console.error("Deployment failed:",i),this.showNotification(`Deployment failed: ${i.message}`,"error"),this.addRecentActivity(`Deployment failed: ${i.message}`,"error")}}clearLogs(){let e=document.getElementById("logContainer");e.innerHTML=""}appendLog(e,t="stdout"){let n=document.getElementById("logContainer"),o=document.createElement("div");o.className=`mb-1 ${t==="stderr"?"text-red-400":t==="info"?"text-dia-gold":"text-gray-300"}`;let s=new Date().toLocaleTimeString();o.innerHTML=`
            <span class="text-gray-500 text-xs">[${s}]</span> 
            <span>${this.escapeHtml(e)}</span>
        `,n.appendChild(o),n.scrollTop=n.scrollHeight}updateDeploymentStatus(e,t){let n=e==="completed"?"text-green-400":e==="failed"?"text-red-400":"text-yellow-400";this.appendLog(`\u{1F4CA} Deployment ${e} (exit code: ${t})`,"info"),(e==="completed"||e==="failed")&&(this.currentDeployment=null,this.updateActiveDeployments(),this.addRecentActivity(`Deployment ${e}`,e==="completed"?"success":"error"))}updateActiveDeployments(){let e=this.currentDeployment?1:0;document.getElementById("activeDeployments").textContent=e}showNotification(e,t="info"){let n=document.createElement("div");n.className=`
            fixed top-4 right-4 z-50 max-w-sm w-full bg-dia-dark border-l-4 p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300
            ${t==="success"?"border-green-400":t==="error"?"border-red-400":t==="warning"?"border-yellow-400":"border-dia-orange"}
        `;let o=t==="success"?"check-circle":t==="error"?"exclamation-circle":t==="warning"?"exclamation-triangle":"info-circle",s=t==="success"?"text-green-400":t==="error"?"text-red-400":t==="warning"?"text-yellow-400":"text-dia-orange";n.innerHTML=`
            <div class="flex items-center">
                <i class="fas fa-${o} ${s} mr-3"></i>
                <span class="text-white">${e}</span>
                <button class="ml-auto text-gray-400 hover:text-white" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `,document.body.appendChild(n),setTimeout(()=>{n.classList.remove("translate-x-full")},100),setTimeout(()=>{n.classList.add("translate-x-full"),setTimeout(()=>n.remove(),300)},5e3)}toggleTheme(){let e=document.documentElement,t=document.querySelector("#themeToggle i");e.classList.contains("dark")?(e.classList.remove("dark"),t.className="fas fa-sun"):(e.classList.add("dark"),t.className="fas fa-moon")}animatePageLoad(){document.querySelectorAll(".animate-slide-up").forEach((t,n)=>{setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},n*100)})}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}};document.addEventListener("DOMContentLoaded",()=>{new c});})();
